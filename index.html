<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìã Avalia√ß√£o Psiqui√°trica ¬∑ CAPS / Ambulat√≥rio</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: #e6f0f7;
            font-family: 'Inter', 'Segoe UI', Roboto, sans-serif;
            padding: 1.8rem;
            color: #0d2b3e;
        }
        .container {
            max-width: 1500px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 1.8rem;
        }
        h1 { font-size: 2.4rem; font-weight: 500; border-bottom: 4px solid #2b7aa2; padding-bottom: 0.5rem; color: #07405c; letter-spacing: -0.5px; }
        h2 { font-size: 1.6rem; margin: 0.5rem 0 0.5rem; color: #155e87; border-left: 6px solid #3f98c9; padding-left: 1rem; background: linear-gradient(to right, #f1f9ff, transparent);}
        h3 { font-size: 1.2rem; margin: 1.2rem 0 0.4rem; color: #1c5777; display: flex; align-items: center; gap: 0.6rem; }
        .card {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(2px);
            border-radius: 28px;
            padding: 1.8rem 2.2rem;
            box-shadow: 0 20px 35px -5px rgba(2,65,100,0.25);
            border: 1px solid rgba(60,150,210,0.25);
        }
        .flex-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1.8rem;
            align-items: center;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            min-width: 160px;
        }
        .input-group label, .label-mini {
            font-weight: 700;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            color: #1b6385;
            margin-bottom: 0.2rem;
        }
        .input-group input, .input-group select, .input-group textarea {
            padding: 0.7rem 1rem;
            border: 1.5px solid #c1ddef;
            border-radius: 30px;
            font-size: 0.95rem;
            background: white;
            transition: 0.2s;
            font-family: inherit;
        }
        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            border-color: #1f88c2;
            box-shadow: 0 0 0 4px rgba(28,124,184,0.2);
            outline: none;
        }
        textarea { min-height: 70px; resize: vertical; }
        .inline-label { display: flex; align-items: center; gap: 0.7rem; flex-wrap: wrap; }
        .badge {
            background: #daeefb;
            padding: 0.3rem 1.3rem;
            border-radius: 40px;
            font-weight: 600;
            color: #035e8f;
        }
        .btn {
            background: #1d78a3;
            border: none;
            color: white;
            font-weight: 600;
            padding: 0.8rem 2.2rem;
            border-radius: 60px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 6px 12px rgba(10,80,120,0.3);
            border: 1px solid rgba(255,255,255,0.3);
        }
        .btn:hover {
            background: #0b5d86;
            transform: translateY(-2px);
            box-shadow: 0 12px 20px rgba(0,50,80,0.3);
        }
        .btn-copy { background: #2a7555; float: right; }
        .table-meem {
            width: 100%;
            border-collapse: collapse;
            background: #f0f8ff;
            border-radius: 24px;
            overflow: hidden;
            margin: 1.2rem 0;
        }
        .table-meem th { background: #b8dbf2; padding: 0.9rem; font-weight: 700; }
        .table-meem td { padding: 0.7rem 1rem; border-bottom: 1px solid #cbdef0; }
        .table-meem select { padding: 0.3rem 1rem; border-radius: 30px; border: 1px solid #8cb3d1; }
        .output-box {
            background: #0d2a35;
            color: #e1f2fc;
            padding: 1.8rem 2.2rem;
            border-radius: 32px;
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            border: 2px solid #256f94;
            max-height: 450px;
            overflow: auto;
            box-shadow: inset 0 0 18px #00000050;
        }
        .grid-2c {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 1.8rem;
            margin: 0.5rem 0;
        }
        .medicamento-item {
            background: #e8f3fd;
            border-radius: 24px;
            padding: 1rem 1.5rem;
            margin-bottom: 0.8rem;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: flex-end;
        }
        .inline-input { display: flex; flex-direction: column; min-width: 130px; }
    </style>
</head>
<body>
<div class="container">
    <h1>üß† EXAME PS√çQUICO ¬∑ CAPS (anamnese integrada)</h1>

    <!-- ############# PRIMEIRA PARTE: QD + SEXO/IDADE/IMC ############# -->
    <div class="card">
        <h2>üìå 1. Identifica√ß√£o e queixa</h2>
        <div class="flex-row">
            <div class="input-group"><label>Sexo</label>
                <select id="sexo"><option value="feminino">Feminino</option><option value="masculino">Masculino</option><option value="outro">Outro</option></select>
            </div>
            <div class="input-group"><label>Idade (anos)</label><input type="number" id="idade" value="42" min="0" max="120"></div>
            <div class="input-group"><label>Peso (kg)</label><input type="number" id="peso" step="0.1" value="68.5" min="20" max="250"></div>
            <div class="input-group"><label>Altura (m)</label><input type="number" id="altura" step="0.01" value="1.68" min="1.0" max="2.5"></div>
            <div class="input-group"><label>IMC (autom√°tico)</label><input type="text" id="imc" readonly value="24.3"></div>
            <div class="input-group"><label>Classifica√ß√£o IMC</label><input type="text" id="classIMC" readonly value="Peso normal"></div>
        </div>
        <div class="input-group" style="margin-top:1.2rem; width:100%;">
            <label>üìù QUEIXA PRINCIPAL (QD) / motivo da consulta:</label>
            <textarea id="queixaPrincipal" placeholder="Ex.: 'tristeza profunda, falta de vontade, ins√¥nia' ...">tristeza, des√¢nimo, ideias de morte</textarea>
        </div>
    </div>

    <!-- ############# ANTECEDENTES PESSOAIS / FAMILIARES / COMORBIDADES ############# -->
    <div class="card">
        <h2>üìã 2. Antecedentes ¬∑ Hist√≥ria pessoal e familiar</h2>
        <div class="grid-2c">
            <div>
                <label class="label-mini">Antecedentes pessoais (desenvolvimento, inf√¢ncia, trauma)</label>
                <textarea id="antePessoais" placeholder="ex.: nascimento normal, marcos do desenvolvimento adequados, sem trauma">desenvolvimento normal, nega abuso</textarea>
            </div>
            <div>
                <label class="label-mini">Antecedentes familiares (transtornos mentais, suic√≠dio)</label>
                <textarea id="anteFamiliares" placeholder="pai alcoolista, m√£e com depress√£o">m√£e com depress√£o recorrente; irm√£ tentou suic√≠dio</textarea>
            </div>
        </div>
        <div style="margin-top:1.2rem">
            <label class="label-mini">üßæ Comorbidades cl√≠nicas ( HAS, DM, epilepsia ... )</label>
            <textarea id="comorbidades" placeholder="hipertens√£o, hipotireoidismo...">HAS, diabetes tipo 2</textarea>
        </div>
    </div>

    <!-- ############# MEDICAMENTOS + TERAPIA ############# -->
    <div class="card">
        <h2>üíä 3. Medica√ß√µes em uso e psicoterapia</h2>
        <div id="medicamentosContainer">
            <!-- modelo de linha de medicamento ser√° inserido via js, mas deixaremos fixo um exemplo e um extra -->
        </div>
        <div class="medicamento-item" id="medRow1">
            <div class="inline-input"><label>Nome (med 1)</label><input type="text" id="medNome1" value="Sertralina"></div>
            <div class="inline-input"><label>Dose</label><input type="text" id="medDose1" value="50mg/dia"></div>
            <div class="inline-input"><label>Tempo uso</label><input type="text" id="medTempo1" value="6 meses"></div>
            <div class="inline-input"><label>Indica√ß√£o</label><input type="text" id="medInd1" value="depress√£o"></div>
        </div>
        <div class="medicamento-item" id="medRow2">
            <div class="inline-input"><label>Nome (med 2)</label><input type="text" id="medNome2" value="Losartana"></div>
            <div class="inline-input"><label>Dose</label><input type="text" id="medDose2" value="50mg/dia"></div>
            <div class="inline-input"><label>Tempo uso</label><input type="text" id="medTempo2" value="2 anos"></div>
            <div class="inline-input"><label>Indica√ß√£o</label><input type="text" id="medInd2" value="HAS"></div>
        </div>
        <div style="margin: 1rem 0 0.5rem;">
            <label class="label-mini">üßò Acompanhamento psicoter√°pico?</label>
            <select id="terapiaSelect">
                <option value="n√£o faz terapia">n√£o faz terapia</option>
                <option value="psicoterapia semanal (psican√°lise)">psicoterapia semanal (psican√°lise)</option>
                <option value="psicoterapia cognitivo-comportamental">TCC</option>
                <option value="grupo de apoio CAPS">grupo de apoio CAPS</option>
                <option value="outro">outro</option>
            </select>
        </div>
    </div>

    <!-- ############# MINI-EXAME ESTADO MENTAL (CORRIGIDO) ############# -->
    <div class="card">
        <h2>üß© 4. MEEM (Mini-Exame do Estado Mental)  Total: <span id="meemTotalDisplay">0</span>/30</h2>
        <table class="table-meem">
            <tr><th>Item</th><th>Pontua√ß√£o</th></tr>
            <tr><td>Orienta√ß√£o temporal (ano, esta√ß, dia, m√™s, dia m√™s) 0-5</td><td><select id="meem1" class="meem">${[0,1,2,3,4,5].map(i=>`<option value="${i}">${i}</option>`).join('')}</select></td></tr>
            <tr><td>Orienta√ß√£o espacial (pa√≠s, estado, cidade, local, andar) 0-5</td><td><select id="meem2" class="meem">${[0,1,2,3,4,5].map(i=>`<option value="${i}">${i}</option>`).join('')}</select></td></tr>
            <tr><td>Registro (pente, rua, azul) 0-3</td><td><select id="meem3" class="meem">${[0,1,2,3].map(i=>`<option value="${i}">${i}</option>`).join('')}</select></td></tr>
            <tr><td>Aten√ß√£o/c√°lculo (100-7 ou s√©rie) 0-5</td><td><select id="meem4" class="meem">${[0,1,2,3,4,5].map(i=>`<option value="${i}">${i}</option>`).join('')}</select></td></tr>
            <tr><td>Evoca√ß√£o (3 palavras) 0-3</td><td><select id="meem5" class="meem">${[0,1,2,3].map(i=>`<option value="${i}">${i}</option>`).join('')}</select></td></tr>
            <tr><td>Linguagem: nomear l√°pis/rel√≥gio 0-2</td><td><select id="meem6" class="meem">${[0,1,2].map(i=>`<option value="${i}">${i}</option>`).join('')}</select></td></tr>
            <tr><td>Repetir "nem aqui, nem ali, nem l√°" 0-1</td><td><select id="meem7" class="meem"><option value="0">0</option><option value="1" selected>1</option></select></td></tr>
            <tr><td>Comando tr√™s est√°gios (pegar/dobrar/ch√£o) 0-3</td><td><select id="meem8" class="meem">${[0,1,2,3].map(i=>`<option value="${i}">${i}</option>`).join('')}</select></td></tr>
            <tr><td>Ler e executar "FECHE OS OLHOS" 0-1</td><td><select id="meem9" class="meem"><option value="0">0</option><option value="1">1</option></select></td></tr>
            <tr><td>Escrever uma frase 0-1</td><td><select id="meem10" class="meem"><option value="0">0</option><option value="1">1</option></select></td></tr>
            <tr><td>Copiar desenho 0-1</td><td><select id="meem11" class="meem"><option value="0">0</option><option value="1">1</option></select></td></tr>
        </table>
    </div>

    <!-- ############# FUN√á√ïES PS√çQUICAS (APEJUCOL) ############# -->
    <div class="card">
        <h2>üîé 5. Exame ps√≠quico (selecionar itens)</h2>
        <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(280px,1fr)); gap: 1.2rem;">
            <div><label>Consci√™ncia</label> <select id="consciencia"><option value="l√∫cido">l√∫cido</option><option value="obnubilado">obnubilado</option><option value="sonolento">sonolento</option><option value="torporoso">torporoso</option><option value="delirium">delirium</option></select></div>
            <div><label>Aten√ß√£o</label> <select id="atencao"><option value="normoprosexia">normoprosexia</option><option value="hipoprosexia">hipoprosexia</option><option value="hiperprosexia">hiperprosexia</option><option value="distra√ß√£o">distra√ß√£o</option><option value="disprosexia">disprosexia</option></select></div>
            <div><label>Orienta√ß√£o</label> <select id="orientacao"><option value="orientado auto e alopsiquicamente">orientado</option><option value="desorientado temporal">desorientado temporal</option><option value="desorientado espacial">desorientado espacial</option><option value="desorienta√ß√£o amn√©sica">desorienta√ß√£o amn√©sica</option></select></div>
            <div><label>Mem√≥ria</label> <select id="memoria"><option value="preservada">preservada</option><option value="hipomn√©sia anter√≥grada">hipomn√©sia anter√≥grada</option><option value="amn√©sia retr√≥grada">amn√©sia retr√≥grada</option><option value="confabula√ß√£o">confabula√ß√£o</option></select></div>
            <div><label>Intelig√™ncia</label> <select id="inteligencia"><option value="dentro da m√©dia">dentro da m√©dia</option><option value="inferior √† m√©dia">inferior</option><option value="deficit moderado">d√©ficit moderado</option></select></div>
            <div><label>Sensopercep√ß√£o</label> <select id="sensopercepcao"><option value="sem altera√ß√µes">sem altera√ß√µes</option><option value="alucina√ß√£o auditiva">alucina√ß√£o auditiva</option><option value="alucina√ß√£o visual">alucina√ß√£o visual</option><option value="ilus√£o">ilus√£o</option><option value="desrealiza√ß√£o">desrealiza√ß√£o</option></select></div>
            <div><label>Afeto/humor</label> <select id="afeto"><option value="eut√≠mico">eut√≠mico</option><option value="depressivo">depressivo</option><option value="ansioso">ansioso</option><option value="euf√≥rico">euf√≥rico</option><option value="embotado">embotado</option><option value="irrit√°vel">irrit√°vel</option></select></div>
            <div><label>Pensamento (curso)</label> <select id="pensamentoCurso"><option value="regular">regular</option><option value="acelerado (taquipsiquismo)">acelerado</option><option value="lentificado">lentificado</option><option value="fuga de id√©ias">fuga de id√©ias</option><option value="bloqueio">bloqueio</option></select></div>
            <div><label>Conte√∫do pensamento</label> <select id="conteudo"><option value="sem del√≠rios">sem del√≠rios</option><option value="del√≠rio persecut√≥rio">persecut√≥rio</option><option value="del√≠rio de grandeza">grandeza</option><option value="idea√ß√£o suicida">idea√ß√£o suicida</option><option value="obsess√µes">obsess√µes</option></select></div>
            <div><label>Linguagem</label> <select id="linguagem"><option value="fluente">fluente</option><option value="logorreia">logorreia</option><option value="mutismo">mutismo</option><option value="ecolalia">ecolalia</option><option value="neologismos">neologismos</option></select></div>
            <div><label>Psicomotricidade</label> <select id="psicomotricidade"><option value="normal">normal</option><option value="agitado">agitado</option><option value="lentificado">lentificado</option><option value="estereotipias">estereotipias</option></select></div>
            <div><label>Vontade</label> <select id="vontade"><option value="normobulia">normobulia</option><option value="hipobulia">hipobulia</option><option value="abulia">abulia</option></select></div>
            <div><label>Ju√≠zo cr√≠tico</label> <select id="juizo"><option value="preservado">preservado</option><option value="parcial">parcial</option><option value="prejudicado">prejudicado</option></select></div>
        </div>
    </div>

    <!-- ############# GERADOR E OUTPUT ############# -->
    <div style="display: flex; gap: 1.5rem; align-items: center; flex-wrap: wrap;">
        <button class="btn" id="gerarHDA">üìÑ GERAR HDA + CONDUTA</button>
        <button class="btn btn-copy" id="copiarTexto">üìã COPIAR EVOLU√á√ÉO</button>
    </div>
    <div class="output-box" id="outputFinal">
        Pressione o bot√£o para gerar o texto com base nos campos preenchidos.
    </div>
    <div class="footer-notes">
        * IMC autom√°tico; QD, antecedentes, comorbidades, medica√ß√µes (2 linhas) e terapia inclusos. MEEM sem placeholders.
    </div>
</div>

<script>
    (function() {
        // ---------- FUN√á√ÉO IMC AUTOM√ÅTICO ----------
        function updateIMC() {
            const peso = parseFloat(document.getElementById('peso').value) || 0;
            const altura = parseFloat(document.getElementById('altura').value) || 1;
            if (peso <= 0 || altura < 0.5) {
                document.getElementById('imc').value = '';
                document.getElementById('classIMC').value = '';
                return;
            }
            const imc = peso / (altura * altura);
            let classe = '';
            if (imc < 18.5) classe = 'Abaixo do peso';
            else if (imc < 25) classe = 'Peso normal';
            else if (imc < 30) classe = 'Sobrepeso';
            else if (imc < 35) classe = 'Obesidade I';
            else if (imc < 40) classe = 'Obesidade II';
            else classe = 'Obesidade III';
            document.getElementById('imc').value = imc.toFixed(1);
            document.getElementById('classIMC').value = classe;
        }
        ['peso','altura'].forEach(id => document.getElementById(id).addEventListener('input', updateIMC));
        updateIMC();

        // ---------- MEEM total ----------
        const meemSelects = document.querySelectorAll('.meem');
        function calcMEEM() {
            let total = 0;
            meemSelects.forEach(sel => { total += parseInt(sel.value || 0); });
            document.getElementById('meemTotalDisplay').innerText = total;
            return total;
        }
        meemSelects.forEach(s => s.addEventListener('change', calcMEEM));
        calcMEEM();

        // ---------- GERAR HDA + CONDUTA ----------
        document.getElementById('gerarHDA').addEventListener('click', function() {
            const sexo = document.getElementById('sexo').value;
            const idade = document.getElementById('idade').value;
            const imc = document.getElementById('imc').value;
            const classeImc = document.getElementById('classIMC').value;
            const qd = document.getElementById('queixaPrincipal').value.trim() || 'n√£o informada';
            const antePessoal = document.getElementById('antePessoais').value.trim() || 'sem informa√ß√£o';
            const anteFamiliar = document.getElementById('anteFamiliares').value.trim() || 'sem informa√ß√£o';
            const comorb = document.getElementById('comorbidades').value.trim() || 'nenhuma';

            // medica√ß√µes 1 e 2 (pode-se ampliar depois)
            const med1 = document.getElementById('medNome1')?.value || ''; const dose1 = document.getElementById('medDose1')?.value || ''; const tempo1 = document.getElementById('medTempo1')?.value || ''; const ind1 = document.getElementById('medInd1')?.value || '';
            const med2 = document.getElementById('medNome2')?.value || ''; const dose2 = document.getElementById('medDose2')?.value || ''; const tempo2 = document.getElementById('medTempo2')?.value || ''; const ind2 = document.getElementById('medInd2')?.value || '';
            let medText = '';
            if (med1) medText += `\n- ${med1} ${dose1} (${tempo1}) para ${ind1}`;
            if (med2) medText += `\n- ${med2} ${dose2} (${tempo2}) para ${ind2}`;
            if (!med1 && !med2) medText = ' nenhum medicamento referido.';

            const terapia = document.getElementById('terapiaSelect').value;

            // fun√ß√µes ps√≠quicas
            const consc = document.getElementById('consciencia').value;
            const atenc = document.getElementById('atencao').value;
            const orient = document.getElementById('orientacao').value;
            const mem = document.getElementById('memoria').value;
            const intel = document.getElementById('inteligencia').value;
            const sens = document.getElementById('sensopercepcao').value;
            const afet = document.getElementById('afeto').value;
            const pensCurso = document.getElementById('pensamentoCurso').value;
            const conteudoPens = document.getElementById('conteudo').value;
            const ling = document.getElementById('linguagem').value;
            const psicomot = document.getElementById('psicomotricidade').value;
            const vont = document.getElementById('vontade').value;
            const juizo = document.getElementById('juizo').value;
            const meemTotal = calcMEEM();

            // --- HDA texto
            let hda = `HIST√ìRIA DA DOEN√áA ATUAL (gerada automaticamente)\n`;
            hda += `Paciente ${sexo}, ${idade} anos, IMC=${imc} (${classeImc}). QD: "${qd}".\n`;
            hda += `Antecedentes pessoais: ${antePessoal}. Familiares: ${anteFamiliar}. Comorbidades: ${comorb}.\n`;
            hda += `Medica√ß√µes em uso: ${medText}\nPsicoterapia: ${terapia}.\n`;
            hda += `Evolu√ß√£o: segundo relato, apresenta `;
            if (afet.includes('depress')) hda += `humor deprimido, `;
            if (conteudoPens.includes('suicida')) hda += `idea√ß√£o suicida, `;
            if (sens.includes('alucina√ß√£o')) hda += `${sens}, `;
            if (pensCurso.includes('acelerado')) hda += `pensamento acelerado, `;
            if (psicomot.includes('agitado')) hda += `agita√ß√£o psicomotora, `;
            if (mem.includes('hipomn√©sia')) hda += `queixas de mem√≥ria recente, `;
            hda = hda.replace(/, $/, '') + '.\n';

            hda += `MEEM ${meemTotal}/30. `;

            // exame ps√≠quico
            let exame = `\nEXAME PS√çQUICO:\n`;
            exame += `Consci√™ncia: ${consc}. Aten√ß√£o: ${atenc}. Orienta√ß√£o: ${orient}. Mem√≥ria: ${mem}. Intelig√™ncia: ${intel}. Sensopercep√ß√£o: ${sens}.\n`;
            exame += `Afeto: ${afet}. Pensamento curso: ${pensCurso}. Conte√∫do: ${conteudoPens}. Linguagem: ${ling}. Psicomotricidade: ${psicomot}. Vontade: ${vont}. Ju√≠zo cr√≠tico: ${juizo}.\n`;

            // conduta autom√°tica
            let conduta = `\nCONDUTA / PLANO (autom√°tica):\n`;
            if (conteudoPens.includes('suicida') || conteudoPens.includes('auto')) conduta += 'üö® Risco de suic√≠dio ‚Äì avaliar necessidade de interna√ß√£o/observa√ß√£o. ';
            if (sens.includes('alucina√ß√£o') && juizo.includes('prejudicado')) conduta += 'Sintomas psic√≥ticos ativos ‚Äì considerar antipsic√≥tico. ';
            if (afet.includes('depress')) conduta += 'Humor deprimido ‚Äì otimizar antidepressivo e suporte psicossocial. ';
            if (mem.includes('hipomn√©sia') || meemTotal < 24) conduta += 'Decl√≠nio cognitivo ‚Äì solicitar exames (neuroimagem, laborat√≥rio) e avaliar dem√™ncia. ';
            if (psicomot.includes('estereo') || psicomot.includes('agitado')) conduta += 'Necess√°rio manejo da agita√ß√£o/estereotipias. ';
            conduta += '\nRetorno em 2 semanas. Articular com equipe multidisciplinar.';

            document.getElementById('outputFinal').innerText = hda + exame + conduta;
        });

        // copiar
        document.getElementById('copiarTexto').addEventListener('click', function() {
            const texto = document.getElementById('outputFinal').innerText;
            navigator.clipboard.writeText(texto).then(() => alert('‚úÖ Copiado!'));
        });

        // garantir que MEEM n√£o mostre ${i} (j√° est√° ok)
        // adicional: se quiser mais medicamentos, pode-se implementar, mas mantivemos dois fixos para clareza
    })();
</script>
<!-- corre√ß√£o dos selects (os placeholders ${i} foram substitu√≠dos por valores num√©ricos no inner html) -->
</body>
                                                                                    </html>
